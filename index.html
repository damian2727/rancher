<!DOCTYPE html>
<html>
<head>
  <title>Tokens en RanchersLand</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
    input, button { padding: 0.5rem; font-size: 1rem; margin-top: 0.5rem; }
    pre { background: #f9f9f9; padding: 1rem; border-radius: 5px; margin-top: 1rem; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>Tokens de RanchersLand</h2>
  <input id="account" placeholder="usuario.wam (ej: 2j5uw.wam)" />
  <button id="btn">Consultar</button>
  <pre id="out">Ingresa una cuenta y presiona "Consultar"</pre>

  <script>
document.getElementById('btn').addEventListener('click', async () => {
  const acc = document.getElementById('account').value.trim();
  const out = document.getElementById('out');
  const btn = document.getElementById('btn');

  if (!/^[a-z1-5.]{1,12}\.wam$/.test(acc)) {
    out.textContent = '❌ Cuenta inválida. Debe terminar en .wam';
    return;
  }

  out.textContent = '⏳ Buscando tokens en ranchersland...';
  btn.disabled = true;
  btn.textContent = 'Consultando...';

  try {
    const res = await fetch('https://wax.pink.gg/v1/chain/get_table_rows', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        json: true,
        code: 'ranchersland',
        scope: 'ranchersland',  // <-- Nota: scope fijo
        table: 'accounts',
        limit: 1000
      })
    });

    const data = await res.json();
    const tokens = data.rows.filter(row => row.owner === acc);

    if (tokens.length > 0) {
      const balances = tokens.map(t => `${t.balance}`).join('\n');
      out.textContent = `✅ ${acc} tiene los siguientes tokens:\n\n${balances}`;
    } else {
      out.textContent = `ℹ️ ${acc} no tiene tokens registrados en ranchersland.`;
    }
  } catch (e) {
    console.error(e);
    out.textContent = '❌ Error al consultar: ' + e.message;
  }

  btn.disabled = false;
  btn.textContent = 'Consultar';
});
</script>
</body>
</html>