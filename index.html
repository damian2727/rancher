<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tokens de RanchersLand</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
      background: #f4f4f4;
    }
    input, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-top: 0.5rem;
    }
    table {
      width: 100%;
      margin-top: 1rem;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #222;
      color: white;
    }
    td img {
      height: 24px;
      vertical-align: middle;
      margin-right: 0.5rem;
    }
    #msg {
      margin-top: 1rem;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <h2>Consultar tokens de RanchersLand</h2>
  <input id="account" placeholder="Ingresa tu cuenta .wam (ej: tzgru.wam)" />
  <button id="btn">Consultar</button>
  <div id="msg">Ingresa tu cuenta y presiona "Consultar"</div>
  <table id="result" style="display:none">
    <thead>
      <tr><th>Token</th><th>Balance</th></tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <script>
    const tokenIcons = {
      "FOOD": "https://i.postimg.cc/1zN1Nzbh/food.png",
      "WOOD": "https://i.postimg.cc/wByFvqnJ/wood.png",
      "GOLD": "https://i.postimg.cc/mkJ6FrW0/gold.png",
      "STONE": "https://i.postimg.cc/0NCh3qdF/stone.png"
      // Agrega más tokens si lo deseas
    };

    document.getElementById('btn').addEventListener('click', async () => {
      const acc = document.getElementById('account').value.trim();
      const msg = document.getElementById('msg');
      const table = document.getElementById('result');
      const tbody = document.getElementById('tbody');

      table.style.display = "none";
      tbody.innerHTML = "";
      msg.textContent = '⏳ Consultando tokens...';

      if (!/^[a-z1-5.]{1,12}\.wam$/.test(acc)) {
        msg.textContent = '❌ Cuenta inválida. Ej: tzgru.wam';
        return;
      }

      try {
        const res = await fetch('https://wax.pink.gg/v1/chain/get_table_rows', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            json: true,
            code: 'ranchersland',
            scope: 'ranchersland',
            table: 'accounts',
            limit: 2000
          })
        });
        const data = await res.json();
        console.log('Respuesta completa:', data);

        if (!Array.isArray(data.rows)) {
          msg.textContent = '❌ La respuesta no contiene rows.';
          return;
        }

        const tokens = data.rows.filter(row =>
          row.owner === acc ||
          row.account === acc ||
          row.user === acc ||
          row.scope === acc
        );
        console.log('Tokens filtrados:', tokens);

        if (tokens.length === 0) {
          msg.textContent = `ℹ️ ${acc} no tiene tokens registrados (o campo incorrecto).`;
          return;
        }

        tokens.forEach(row => {
          const [amount, symbol] = (row.balance || '').split(' ');
          const icon = tokenIcons[symbol] || "https://i.postimg.cc/wTPccFbf/question.png";
          const tr = document.createElement('tr');
          tr.innerHTML = `<td><img src="${icon}" alt="${symbol}">${symbol}</td><td>${amount || '?'}</td>`;
          tbody.appendChild(tr);
        });

        msg.textContent = `✅ ${acc} tiene ${tokens.length} token(s):`;
        table.style.display = "table";

      } catch (e) {
        console.error(e);
        msg.textContent = '❌ Error al conectar: ' + e.message;
      }
    });
  </script>
</body>
</html>

